#!/bin/bash

# Locate GIT
if [ -f "$(readlink -m "$0"/../..)/docker/Makefile" ]
then
    DIR="$(readlink -m "$0"/../..)"
elif [ -f "$HOME/git/system-config/docker/Makefile" ]
then
    DIR="$HOME/git/system-config"
else
    echo "Error: Cannot locate \"git/system-config/docker/Makefile\""
    exit 1
fi

# Use current working directory
export FLAGS="--workdir=$PWD"

# Root user
for FILE in profile vimrc tmux.conf
do
    FLAGS="$FLAGS --volume=$DIR/config/$FILE:/root/.$FILE:ro"
done

export COMMAND="$@"
exec make --quiet -C $DIR/docker run-sudo
