#!/bin/bash
#
# Docker container init script
#

echo "Running \"$0\"..."

# Process plugins
for FILE in /etc/docker-init-*
do
    $FILE
done

if [ ! "$USER" ]
then
    echo "Starting \"root\" login shell..."
    exec /bin/bash -l
fi

# Switch to user $USER
export HOME=$(grep "^$USER:" /etc/passwd | cut -f6 -d:)
cd $HOME
if [ $# != 0 -a "$1" != "$0" ]
then
    echo "Starting \"$@\" app..."
    sudo -E -u $USER "$@"
else
    echo "Starting \"$USER\" login shell..."
    sudo -E -u $USER bash -l
fi

echo "Finished \"$0\"..."
if [ "$$" = 1 ]
then
    echo "Stopping Docker container!"
fi
